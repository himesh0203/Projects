import json
from collections import defaultdict

class SmartShoppingList:
    def __init__(self, user_data_file="user_shopping_data.json"):
        self.user_data_file = user_data_file
        self.user_data = self._load_user_data()

    def _load_user_data(self):
        try:
            with open(self.user_data_file, 'r') as f:
                return json.load(f)
        except FileNotFoundError:
            return {"past_purchases": defaultdict(int), "dietary_preferences": []}

    def _save_user_data(self):
        with open(self.user_data_file, 'w') as f:
            json.dump(self.user_data, f, indent=4)

    def add_purchase(self, item, quantity=1):
        self.user_data["past_purchases"][item] += quantity
        self._save_user_data()
        print(f"Added {quantity} of '{item}' to past purchases.")

    def set_dietary_preferences(self, preferences):
        self.user_data["dietary_preferences"] = preferences
        self._save_data()
        print(f"Dietary preferences updated: {', '.join(preferences)}")

    def generate_list(self, num_suggestions=5):
        suggested_items = []
        # Prioritize frequently purchased items
        sorted_purchases = sorted(self.user_data["past_purchases"].items(), key=lambda item: item[1], reverse=True)

        for item, _ in sorted_purchases:
            # Filter based on dietary preferences (a more complex system would check ingredients)
            if not self.user_data["dietary_preferences"] or \
               any(pref.lower() in item.lower() for pref in self.user_data["dietary_preferences"]):
                suggested_items.append(item)
            if len(suggested_items) >= num_suggestions:
                break

        print("\nSuggested Shopping List:")
        if suggested_items:
            for i, item in enumerate(suggested_items):
                print(f"{i+1}. {item}")
        else:
            print("No suggestions based on current data. Start adding purchases!")

# Example Usage:
if __name__ == "__main__":
    shopping_assistant = SmartShoppingList()

    # Simulate adding past purchases
    shopping_assistant.add_purchase("Milk", 2)
    shopping_assistant.add_purchase("Eggs", 1)
    shopping_assistant.add_purchase("Bread", 1)
    shopping_assistant.add_purchase("Milk", 1)
    shopping_assistant.add_purchase("Apples", 3)
    shopping_assistant.add_purchase("Almond Milk", 1)

    # Set dietary preferences
    shopping_assistant.set_dietary_preferences(["dairy-free", "gluten-free"])

    # Generate a shopping list
    shopping_assistant.generate_list(num_suggestions=3)

    # Add more purchases and regenerate
    shopping_assistant.add_purchase("Gluten-Free Bread", 1)
    shopping_assistant.generate_list(num_suggestions=5)
