structure for such a system using opencv-python and face_recognition.

Installation: Install necessary libraries:
Code

    pip install opencv-python face_recognition numpy pandas



For GPU acceleration with cnn model, dlib with CUDA support is required.
known_faces Directory: Create a directory named known_faces. Inside this, create sub-directories for each individual, named after the person (e.g., known_faces/John_Doe, known_faces/Jane_Smith). Place multiple clear images of each person in their respective sub-directory. These images will be used to train the system.
Configuration: Adjust TOLERANCE for stricter or looser matching and MODEL based on your hardware.
Running the Code: Execute the Python script. It will open a webcam feed. When a known face is detected, it will be identified, and attendance will be logged in a daily CSV file within the attendance_logs directory.
Attendance Logging: The log_attendance function ensures that each person's attendance is logged only once per day in a dedicated CSV file for that date.
User Interface: The system provides a basic visual interface showing the webcam feed with detected faces and their names. Press 'q' to quit the application.



import cv2
import face_recognition
import numpy as np
import os
from datetime import datetime
import pandas as pd

# --- Configuration ---
KNOWN_FACES_DIR = "known_faces"  # Directory to store known face images
ATTENDANCE_LOG_DIR = "attendance_logs" # Directory for attendance CSVs
TOLERANCE = 0.6  # How much distance between faces to consider a match (lower is stricter)
FRAME_THICKNESS = 2
FONT_THICKNESS = 2
MODEL = "hog"  # "hog" for CPU, "cnn" for GPU (if available)

# --- Setup Directories ---
os.makedirs(KNOWN_FACES_DIR, exist_ok=True)
os.makedirs(ATTENDANCE_LOG_DIR, exist_ok=True)

# --- Load Known Faces ---
print("Loading known faces...")
known_face_encodings = []
known_face_names = []

for name in os.listdir(KNOWN_FACES_DIR):
    if os.path.isdir(os.path.join(KNOWN_FACES_DIR, name)):
        for filename in os.listdir(os.path.join(KNOWN_FACES_DIR, name)):
            if filename.endswith((".jpg", ".png", ".jpeg")):
                image_path = os.path.join(KNOWN_FACES_DIR, name, filename)
                image = face_recognition.load_image_file(image_path)
                encodings = face_recognition.face_encodings(image)
                if encodings:
                    known_face_encodings.append(encodings[0])
                    known_face_names.append(name)
                else:
                    print(f"Warning: No face found in {image_path}")
print(f"Loaded {len(known_face_names)} known faces.")

# --- Attendance Logging ---
def log_attendance(name):
    today = datetime.now().strftime("%Y-%m-%d")
    log_file = os.path.join(ATTENDANCE_LOG_DIR, f"attendance_{today}.csv")

    if not os.path.exists(log_file):
        df = pd.DataFrame(columns=["Name", "Time"])
        df.to_csv(log_file, index=False)

    df = pd.read_csv(log_file)
    if name not in df["Name"].values:
        current_time = datetime.now().strftime("%H:%M:%S")
        new_entry = pd.DataFrame([{"Name": name, "Time": current_time}])
        df = pd.concat([df, new_entry], ignore_index=True)
        df.to_csv(log_file, index=False)
        print(f"Attendance logged for: {name} at {current_time}")

# --- Main Attendance System Loop ---
video_capture = cv2.VideoCapture(0)

if not video_capture.isOpened():
    print("Error: Could not open video stream.")
    exit()

print("Starting attendance system. Press 'q' to quit.")

while True:
    ret, frame = video_capture.read()
    if not ret:
        print("Error: Failed to grab frame.")
        break

    # Resize frame for faster processing
    small_frame = cv2.resize(frame, (0, 0), fx=0.25, fy=0.25)
    rgb_small_frame = small_frame[:, :, ::-1]  # Convert BGR to RGB

    face_locations = face_recognition.face_locations(rgb_small_frame, model=MODEL)
    face_encodings = face_recognition.face_encodings(rgb_small_frame, face_locations)

    for (top, right, bottom, left), face_encoding in zip(face_locations, face_encodings):
        matches = face_recognition.compare_faces(known_face_encodings, face_encoding, TOLERANCE)
        name = "Unknown"

        face_distances = face_recognition.face_distance(known_face_encodings, face_encoding)
        best_match_index = np.argmin(face_distances)

        if matches[best_match_index]:
            name = known_face_names[best_match_index]
            log_attendance(name)

        # Scale back up face locations for drawing
        top *= 4
        right *= 4
        bottom *= 4
        left *= 4

        # Draw box and label
        cv2.rectangle(frame, (left, top), (right, bottom), (0, 255, 0), FRAME_THICKNESS)
        cv2.rectangle(frame, (left, bottom - 35), (right, bottom), (0, 255, 0), cv2.FILLED)
        cv2.putText(frame, name, (left + 6, bottom - 6), cv2.FONT_HERSHEY_DUPLEX, 0.8, (255, 255, 255), FONT_THICKNESS)

    cv2.imshow('Smart Attendance System', frame)

    if cv2.waitKey(1) & 0xFF == ord('q'):
        break

video_capture.release()
cv2.destroyAllWindows()
