import pandas as pd
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.metrics.pairwise import linear_kernel

def get_recommendations(title, df, cosine_sim, indices):
    """
    Generates movie recommendations based on a given movie title.

    Args:
        title (str): The title of the movie to get recommendations for.
        df (pd.DataFrame): The DataFrame containing movie data.
        cosine_sim (numpy.ndarray): The cosine similarity matrix.
        indices (pd.Series): A Series mapping movie titles to their indices.

    Returns:
        list: A list of recommended movie titles.
    """
    if title not in indices:
        return ["Movie not found in the database."]

    idx = indices[title]
    sim_scores = list(enumerate(cosine_sim[idx]))
    sim_scores = sorted(sim_scores, key=lambda x: x[1], reverse=True)
    sim_scores = sim_scores[1:11]  # Get top 10 similar movies (excluding itself)
    movie_indices = [i[0] for i in sim_scores]
    return df['title'].iloc[movie_indices].tolist()

# 1. Create a sample dataset (replace with a larger dataset for a real system)
data = {
    'title': ['The Shawshank Redemption', 'The Dark Knight', 'Pulp Fiction', 
              'Forrest Gump', 'Inception', 'The Matrix', 'Interstellar', 
              'Fight Club', 'Goodfellas', 'Spirited Away'],
    'genre': ['Drama', 'Action|Crime|Drama', 'Crime|Drama', 'Drama|Romance', 
              'Action|Sci-Fi|Thriller', 'Action|Sci-Fi', 'Sci-Fi|Drama', 
              'Drama', 'Crime|Drama', 'Animation|Adventure|Fantasy']
}
movies_df = pd.DataFrame(data)

# 2. Preprocess the data: Create a TF-IDF vectorizer for genres
tfidf = TfidfVectorizer(stop_words='english')
tfidf_matrix = tfidf.fit_transform(movies_df['genre'])

# 3. Compute cosine similarity between movies
cosine_sim = linear_kernel(tfidf_matrix, tfidf_matrix)

# 4. Create a reverse mapping of movie titles to their DataFrame indices
indices = pd.Series(movies_df.index, index=movies_df['title']).drop_duplicates()

# 5. Get recommendations for a specific movie
user_movie = "The Dark Knight"
recommendations = get_recommendations(user_movie, movies_df, cosine_sim, indices)

print(f"Recommendations for '{user_movie}':")
for movie in recommendations:
    print(f"- {movie}")

# Example with a movie not in the list
user_movie_not_found = "Avatar"
recommendations_not_found = get_recommendations(user_movie_not_found, movies_df, cosine_sim, indices)
print(f"\nRecommendations for '{user_movie_not_found}':")
for movie in recommendations_not_found:
    print(f"- {movie}")
